{"pageProps":{"title":"Typecho自定义评论列表区域","slug":"typecho-own-comment","created":"2020-12-09T14:36:45.966Z","modified":"2020-12-12T22:50:35.196Z","content":"\n\n## 自定义单条评论的HTML代码\n\n在自定义评论前，先设计好单条评论的 HTML 代码结构，如：\n\n```html\n<li class=\"comment-body comment-parent comment-odd\">\n    <div>\n        <div class=\"comment-author\">\n            <img class=\"avatar\" src=\"avatar.png\" alt=\"\" width=\"40\" height=\"40\">\n            <cite class=\"fn\"><a href=\"评论者主页\">评论者名字</a></cite>\n        </div>\n        <div class=\"comment-meta\">\n            <a href=\"评论地址\">评论时间</a>\n            <span class=\"comment-reply\">回复按钮</span>\n        </div>\n        <p>评论内容</p>\n    </div><!-- 单条信息内容 -->\n    <div class=\"comment-children\">\n        <!-- 评论相关 -->\n    </div>\n</li>\n```\n\n## 使用自定义评论函数\n\n打开 comments.php 文件，需要在它的顶部，插入以下函数代码：\n\n```php\n<?php function threadedComments($comments, $options) {\n    $commentClass = '';\n    if ($comments->authorId) {\n        if ($comments->authorId == $comments->ownerId) {\n            $commentClass .= ' comment-by-author';  //如果是文章作者的评论添加 .comment-by-author 样式\n        } else {\n            $commentClass .= ' comment-by-user';  //如果是评论作者的添加 .comment-by-user 样式\n        }\n    } \n    $commentLevelClass = $comments->_levels > 0 ? ' comment-child' : ' comment-parent';  //评论层数大于0为子级，否则是父级\n?>\n/* 自定义评论的代码结构 */\n<?php } ?>\n```\n\n其次，将刚才自定义好的单条评论的 HTML 代码，放在上面代码里注释的地方，如下：\n\n```php\n<?php function threadedComments($comments, $options) {\n    $commentClass = '';\n    if ($comments->authorId) {\n        if ($comments->authorId == $comments->ownerId) {\n            $commentClass .= ' comment-by-author';  //如果是文章作者的评论添加 .comment-by-author 样式\n        } else {\n            $commentClass .= ' comment-by-user';  //如果是评论作者的添加 .comment-by-user 样式\n        }\n    } \n    $commentLevelClass = $comments->_levels > 0 ? ' comment-child' : ' comment-parent';  //评论层数大于0为子级，否则是父级\n?>\n \n/* 自定义评论的代码结构 */\n<li class=\"comment-body comment-parent comment-odd\">\n    <div>\n        <div class=\"comment-author\">\n            <img class=\"avatar\" src=\"avatar.png\" alt=\"\" width=\"40\" height=\"40\">\n            <cite class=\"fn\"><a href=\"评论者主页\">评论者名字</a></cite>\n        </div>\n        <div class=\"comment-meta\">\n            <a href=\"评论地址\">评论时间</a>\n            <span class=\"comment-reply\">回复按钮</span>\n        </div>\n        <p>评论内容</p>\n    </div><!-- 单条信息内容 -->\n    <div class=\"comment-children\">\n        <!-- 评论相关 -->\n    </div>\n</li>\n<?php } ?>\n```\n\n## 变量替换HTML中相关属性\n\n把 HTML 里相关的属性，替换成 typecho 系统中的评论变量，变量的列表可以参考下面。下面的例子，是替换评论的 id：\n\n```html\n<!-- 替换前 -->\n<li class=\"comment-body comment-parent comment-odd\">\n```\n\n```php\n/* 替换后 */\n<li id=\"li-<?php $comments->theId(); ?>\" class=\"comment-body<?php \nif ($comments->_levels > 0) {\n    echo ' comment-child';\n    $comments->levelsAlt(' comment-level-odd', ' comment-level-even');\n} else {\n    echo ' comment-parent';\n}\n$comments->alt(' comment-odd', ' comment-even');\necho $commentClass; \n?>\">\n```\n\n替换ID需要判断判断当前评论是父级评论还是子级评论，且判断评论 ID 的奇偶数\n\n## 子评论\n\n替换前：\n\n```html\n<div class=\"comment-children\">\n    <!--评论相关 -->\n</div>\n```\n\n替换后后如下：\n\n```html\n<?php if ($comments->children) { ?> //是否子评论\n<div class=\"comment-children\">\n    <?php $comments->threadedComments($options); ?> //嵌套评论所有内容\n</div>\n<?php } ?> //判断结束\n```\n\n## 五、相关变量及说明\n\n| 变量                                    | 说明                                     |\n| --------------------------------------- | ---------------------------------------- |\n| <?php $comments->gravatar('40', ''); ?> | 头像，有两个参数，大小、默认头像         |\n| <?php $comments->author(); ?>           | 评论作者                                 |\n| <?php $comments->permalink(); ?>        | 当前评论的连接地址                       |\n| <?php $comments->date('Y-m-d H:i'); ?>  | 评论时间，可在括号里设置格式             |\n| <?php $comments->reply(); ?>            | 回复按钮，可在括号里自定义评论按钮的文字 |\n| <?php $comments->content(); ?>          | 评论内容                                 |\n\n\n\n## 六、最终得到的代码\n\n当把上面所有变量都替换完成之后，最终得到的代码如下：\n\n```PHP\n<?php function threadedComments($comments, $options) {\n    $commentClass = '';\n    if ($comments->authorId) {\n        if ($comments->authorId == $comments->ownerId) {\n            $commentClass .= ' comment-by-author';\n        } else {\n            $commentClass .= ' comment-by-user';\n        }\n    }\n \n    $commentLevelClass = $comments->levels > 0 ? ' comment-child' : ' comment-parent';\n?>\n \n<li id=\"li-<?php $comments->theId(); ?>\" class=\"comment-body<?php \nif ($comments->levels > 0) {\n    echo ' comment-child';\n    $comments->levelsAlt(' comment-level-odd', ' comment-level-even');\n} else {\n    echo ' comment-parent';\n}\n$comments->alt(' comment-odd', ' comment-even');\necho $commentClass;\n?>\">\n    <div id=\"<?php $comments->theId(); ?>\">\n        <div class=\"comment-author\">\n            <?php $comments->gravatar('40', ''); ?>\n            <cite class=\"fn\"><?php $comments->author(); ?></cite>\n        </div>\n        <div class=\"comment-meta\">\n            <a href=\"<?php $comments->permalink(); ?>\"><?php $comments->date('Y-m-d H:i'); ?></a>\n            <span class=\"comment-reply\"><?php $comments->reply(); ?></span>\n        </div>\n        <?php $comments->content(); ?>\n    </div>\n<?php if ($comments->children) { ?>\n    <div class=\"comment-children\">\n        <?php $comments->threadedComments($options); ?>\n    </div>\n<?php } ?>\n</li>\n<?php } ?>\n```\n\n注意：上面的自定义评论代码输出的，就是本来评论页里的下面这段代码，所以你就不用对这段代码做任何更改了。\n\n```php\n<?php $comments->listComments(); ?>\n```\n\n首次评论审核提示，在自定义评论代码的适当地方添加以下语句，否则将看不到审核提示语句。\n\n```php\n<?php if ('waiting' == $comments->status) { ?><span class=\"text-muted\">您的评论需管理员审核后才能显示！</span><?php } ?>\n```"},"__N_SSG":true}