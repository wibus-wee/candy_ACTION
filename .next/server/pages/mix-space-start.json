{"pageProps":{"title":"éƒ¨ç½²æ–‡æ¡£","subtitle":"Mix-Spaceéƒ¨ç½²æ–‡æ¡£","slug":"mix-space-start","created":"2020-12-06T12:16:52.321Z","modified":"2020-12-06T12:28:31.813Z","content":"\n> è‡´è™šæï¼Œå®ˆé™ç¬ƒã€‚\n\n## å…³äº Mix-Space\n\nä»“åº“ï¼š[https://github.com/mx-space](https://github.com/mx-space)\n\nç”±äºæœ‰å¾ˆå¤šäººä¸ä¼šéƒ¨ç½²ï¼ˆå…¶å®æˆ‘ä¹Ÿæ˜¯ï¼‰äºæ˜¯è¯·æ•™äº†inneiï¼Œç¼–å†™äº†Mix-Space Docsæ–‡æ¡£ã€‚è¯·ä»”ç»†çš„è·Ÿç€å»åšã€‚\n\n## âš ï¸æ³¨æ„\n\n1. ç³»ç»Ÿè¦æ±‚ï¼šMac / Linuxï¼ˆæœ¬æ•™ç¨‹ä½¿ç”¨çš„æ˜¯CentOS 7.6.1810ï¼‰\n2. é…ç½®å‚è€ƒï¼š2æ ¸2G\n3. ç¯å¢ƒè¦æ±‚ï¼šnodejs 14ï¼ŒMongoDBï¼ŒRedis, Yarn 1.22.5\n\n## å·²å®ç°çš„åŠŸèƒ½\n\n* [X] å†™ä½œ\n* [X] å¤‡ä»½\n* [X] å›¾åºŠ\n* [X] å‰ç«¯ UI\n* [X] åå°ä¸åç«¯åŒæ­¥è·Ÿè¿›\n\n## ç¯å¢ƒé…ç½®\n\nå¦‚æœå«Œéº»çƒ¦çš„ï¼Œå¯ä»¥åœ¨ç»ˆç«¯è¿è¡Œæ­¤è„šæœ¬\n\n> MongoDB & Redis & Nginx ä¸å®‰è£…ï¼Œè¯·å‰å¾€å®å¡” è½¯ä»¶å•†åº—æŸ¥æ‰¾å®‰è£…\n\n```bash\n# install nodejs 14 + Yarn 1.22.5\n# ä¸å®‰è£… MongoDB & Redis & Nginx\n# åªéœ€å¤åˆ¶ä¸‹é¢çš„å‘½ä»¤\nwget https://api.iucky.cn/themes/mx-space-1.sh && sh mx-space-1.sh\n```\n\nMongoDB & Redis & Nginx ç”¨å®å¡”å®‰è£…ï¼Œè¿›å…¥è½¯ä»¶å•†åº—æ‰¾æ‰¾\n\n\n## å…‹éš†repo\n\nè¯·æ³¨æ„ï¼å¿…é¡»è¦ä¿æŒåœ¨åŒä¸€ä¸ªç›®å½•ï¼\n\n```bash\ncd\nmkdir mx\ncd mx\ngit clone https://github.com/mx-space/kami\ngit clone https://github.com/mx-space/admin\ngit clone https://github.com/mx-space/server\n```\n\n\n## å‡†å¤‡åŸŸå\n\nè¿™è¾¹å»ºè®®ç›´æ¥è§£æä¸‰ä¸ªåŸŸååˆ°æœåŠ¡å™¨\n\nè¿™é‡Œå‡è®¾è§£æçš„æ˜¯ï¼š\n\nå‰ç«¯ï¼š kami.test.cn\n\nä¸­ç«¯ï¼š admin.test.cn\n\nåç«¯ï¼š server.test.cn\n\n> å½“ç„¶ï¼Œä½ ä¸ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç›´æ¥IPè®¿é—®ï¼Œä½†è®°å¾—å®å¡”å¼€ç«¯å£ï¼\n\n## éƒ¨ç½² Server\n\n1. è¿›å…¥å®å¡”ç«™ç‚¹è®¾ç½®ï¼Œç‚¹å‡»é…ç½®æ–‡ä»¶ï¼Œåœ¨`access_log`é‚£è¡Œå‰é¢åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n![https://gitee.com/wibus/blog-assets-goo/raw/master/asset-pic/iMac_2020-11-29ä¸Šåˆ7.23.58.jpg](https://gitee.com/wibus/blog-assets-goo/raw/master/asset-pic/iMac_2020-11-29%E4%B8%8A%E5%8D%887.23.58.jpg)\n\n```nginx\nlocation /socket.io {\n        proxy_http_version 1.1;\n        proxy_buffering off;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_pass http://127.0.0.1:2333/socket.io;\n    }\n```\n\n\n2. åœ¨æ ¹ç›®å½•è¾“å…¥ `cd mx/server`ï¼Œå®šä½è‡³serveræ–‡ä»¶å¤¹\n   æ¥ç€æˆ‘ä»¬è¾“å…¥`yarn`è¿›è¡Œinstall\n   è¾“å…¥`cp .env.example .env`ï¼Œå¤åˆ¶.env.exampleä¸º.env\n3. è¾“å…¥å‘½ä»¤ï¼švim .env ï¼Œè¾“å…¥iï¼Œè¿›å…¥ä¿®æ”¹æ¨¡å¼ï¼Œä¿®æ”¹å†…å®¹\n   é…ç½®å‚è€ƒåœ¨ä¸‹é¢ğŸ‘‡\n\n### Server .env é…ç½®å‚è€ƒ\n\n```.env\nSECRET=ahsdljasdasdhaisASHLDasdassdasdasrwedwqe\nPORT=2333\nCORS=1\nAPP_MAX_MEMORY=150M\nORIGIN=kami.test.cn,admin.test.cn #ä¿®æ”¹æ­¤é¡¹ä¸ºä½ å‰ç«¯,adminçš„è®¿é—®åœ°å€ï¼Œç”¨,åˆ†å‰²\n```\n\n4. ä¹‹åè¾“å…¥`:wq`é€€å‡ºï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤\n\n```bash\nyarn global add pm2\nyarn global add ts-node\nsh ./build.sh\n```\n\n\n5. æˆ‘ä»¬å»åˆ°å®å¡”çš„ç«™ç‚¹è®¾ç½®ï¼Œç‚¹å‡»åå‘ä»£ç†é€‰é¡¹å¡ï¼Œç‚¹å‡»æ·»åŠ åå‘ä»£ç†\n   `ä»£ç†åç§°`è‡ªå·±éšä¾¿å†™ï¼Œ`ç›®æ ‡URL`å¡«å†™ **[http://127.0.0.1:2333](http://127.0.0.1:2333/)** ï¼Œå…¶ä»–ä¸éœ€è¦æ”¹ï¼Œä¿å­˜å³å¯\n   ![https://gitee.com/wibus/blog-assets-goo/raw/master/asset-pic/iMac_2020-11-29ä¸Šåˆ7.30.53.jpg](https://gitee.com/wibus/blog-assets-goo/raw/master/asset-pic/iMac_2020-11-29%E4%B8%8A%E5%8D%887.30.53.jpg)\n\n## éƒ¨ç½² Admin\n\n1. åœ¨æ ¹ç›®å½•è¾“å…¥ä»¥ä¸‹å‘½ä»¤`cd mx/admin/`ï¼Œ\n   è¾“å…¥`yarn`è¿›è¡Œinstall\n2. è¾“å…¥å‘½ä»¤vim .envï¼Œè¾“å…¥iï¼Œä¿®æ”¹å†…å®¹\n\n\n### Admin .env é…ç½®å‚è€ƒ\n\n```.env\nVUE_APP_BASE_API=https://server.test.cn/api/v1/\nVUE_APP_WEB_URL=https://test.cn\nVUE_APP_GATEWAY=https://server.test.cn\n```\n\n\nä¹‹åè¾“å…¥`:wq`é€€å‡º\n\n3. è¾“å…¥å‘½ä»¤vim vue.config.js ï¼Œè¾“å…¥iï¼Œåˆ é™¤ä»¥ä¸‹çš„å†…å®¹\n\n```js\npublicPath:\nprocess . env . NODE_ ENV\n==\nproduction\n? !process. env. VUE_ APP_ PUBLIC_ URL\n? https://cdn. jsdelivr net/ gh/mx-space/ admin@gh-pages \n```\n\n\n4. ä¹‹åè¾“å…¥`:wq`é€€å‡º\n5. è¾“å…¥å‘½ä»¤ `yarn build` è¿›è¡Œæ„å»º\n   æˆ‘ä»¬è¾“å…¥`cp -rf dist/* /www/wwwroot/admin.test.cn/`ï¼Œå°†æ„å»ºå‡ºæ¥çš„åŒ…ç§»è‡³ç«™ç‚¹ç›®å½•ï¼ˆè¯·å°†admin.test.cnä¿®æ”¹ä¸ºä½ çš„adminåŸŸåï¼‰\n   ä¹‹åAdminå°±éƒ¨ç½²å¥½å•¦ï¼Œè®¿é—®ä¸€ä¸‹adminï¼Œåˆå§‹å¯†ç æ˜¯master\n   å…·ä½“çš„ä½¿ç”¨æ–¹æ³•æˆ‘ä¼šåœ¨ä¸‹é¢ä¸€ä¸€è®²è¿°\n\n## éƒ¨ç½² Kami\n\n1. åœ¨æ ¹ç›®å½•ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤ cd mx/kami/\n   ä¹‹åè¾“å…¥`yarn`è¿›è¡Œinstall\n\nè¾“å…¥`cp next.config.withoutsentry.js next.config.js`ï¼Œå¤åˆ¶æ²¡æœ‰sentryçš„config\n\nè¾“å…¥`cp .env.example .env`ï¼Œå¤åˆ¶ä¾‹å­\n\n2. è¾“å…¥å‘½ä»¤ï¼švim .env ï¼Œè¾“å…¥iï¼Œè¿›å…¥ä¿®æ”¹æ¨¡å¼ï¼Œä¿®æ”¹é‡Œé¢çš„å†…å®¹\n\n\n### Kami .env é…ç½®å‚è€ƒ\n\n```.env\nBASEURL=https://kami.test.cn\nAPIURL=https://server.test.cn/api/v1\nTRACKING_ID= # google analyze's ID\nASSETPREFIX=\nREDIS=1\nGATEWAY_URL=https://server.test.cn\nALWAYS_HTTPS=1\n```\nBASEURL ä¿®æ”¹ä¸ºå‰ç«¯\n\nAPIURL å°†å‰é¢çš„server.test.cnä¿®æ”¹ä¸ºä½ çš„serverç«¯\n\nGATEWAY_URL ä¿®æ”¹è¿™é‡Œä¸ºä½ çš„åç«¯ï¼ˆServerï¼‰\n\n### ä¿®æ”¹Kamié…ç½®ä¿¡æ¯\n\n0. è¾“å…¥`vim configs.ts`ï¼Œè¾“å…¥iï¼Œè¿›å…¥ä¿®æ”¹æ¨¡å¼ï¼Œè‡ªå·±ä¿®æ”¹é‡Œé¢çš„ä¸œè¥¿ï¼ˆæˆ‘åšäº†æ³¨é‡Šçš„ï¼‰\n\n```ts\nimport { faGithub, faQq, faTwitter } from '@fortawesome/free-brands-svg-icons'\nimport { faDotCircle } from '@fortawesome/free-regular-svg-icons'\nimport {\n  faBookOpen,\n  faCircleNotch,\n  faComments,\n  faFeatherAlt,\n  faFlask,\n  faGlasses,\n  faHistory,\n  faMusic,\n  faTv,\n  faUserFriends,\n} from '@fortawesome/free-solid-svg-icons'\nimport { MenuModel, SocialLinkModel } from 'common/store/types'\nconst menu: MenuModel[] = [\n  {\n    title: 'æº',\n    path: '/',\n    type: 'Home',\n    icon: faDotCircle,\n    subMenu: [],\n  },\n  {\n    title: 'æ–‡',\n    path: '/posts',\n    type: 'Post',\n    subMenu: [],\n    icon: faGlasses,\n  },\n  {\n    title: 'è®°',\n    type: 'Note',\n    path: '/notes',\n    icon: faFeatherAlt,\n  },\n  {\n    title: 'è¨€',\n    path: '/says',\n    icon: faComments,\n  },\n  {\n    title: 'è§ˆ',\n    icon: faHistory,\n    path: '/timeline',\n    subMenu: [\n      {\n        title: 'ç”Ÿæ´»',\n        icon: faFeatherAlt,\n        path: '/timeline?type=note',\n      },\n      {\n        title: 'åšæ–‡',\n        icon: faBookOpen,\n        path: '/timeline?type=post',\n      },\n    ],\n  },\n  {\n    title: 'å‹',\n    icon: faUserFriends,\n    path: '/friends',\n  },\n  // {\n  //   title: 'è¶£',\n  //   icon: faCircleNotch,\n  //   path: '/favorite/music',\n  //   subMenu: [\n  //     {\n  //       title: 'éŸ³ä¹',\n  //       icon: faMusic,\n  //       type: 'Music',\n  //       path: '/favorite/music',\n  //     },\n  //     {\n  //       title: 'è¿½ç•ª',\n  //       icon: faTv,\n  //       type: 'Bangumi',\n  //       path: '/favorite/bangumi',\n  //     },\n //      {\n  //       title: 'é¡¹ç›®',\n  //       icon: faFlask,\n  //       type: 'Project',\n  //       path: '/projects',\n  //     },\n  //   ],\n  // },\n]\nconst social: SocialLinkModel[] = [\n  {\n    url: 'https://github.com/wibus-wee', //GitHubä¸»é¡µÎ©\n    title: 'GitHub',\n    icon: faGithub,\n    color: 'var(--black)',\n  },\n  {\n    url: 'https://jq.qq.com/?_wv=1027&k=Z9ovm0he', //QQé“¾æ¥\n    title: 'QQ',\n    icon: faQq,\n    color: '#12b7f5',\n  },\n  {\n    url: '', //æ¨ç‰¹ä¸»é¡µé“¾æ¥\n    title: 'twitter',\n    icon: faTwitter,\n    color: '#02A4ED',\n  },\n]\nexport default {\n  url: 'https://iucky.cn',\n  alwaysHTTPS:\n    process.env.NODE_ENV === 'development'\n      ? false\n      : process.env.ALWAYS_HTTPS && parseInt(process.env.ALWAYS_HTTPS) === 1,\n  social,\n  biliId: 509616661,\n  homePage: 'https://iucky.cn', // footer link\n  menu,\n  icp: {\n    name: 'æ— å¤‡æ¡ˆ', //icpå¤‡æ¡ˆå·\n    url: 'https://iucky.cn/', //icpå¤‡æ¡ˆæŸ¥è¯¢ç½‘å€ï¼ˆæˆ‘ç”±äºæ²¡æœ‰å°±ä¹±å†™äº†ï¼‰\n  },\n  travellings: true, // å¼€å¾€\n  donate: 'https://iucky.cn', //çˆ±å‘ç”µé“¾æ¥\n}\n```\n\n\n1. è¿›å…¥mx/kami/public/manifest.jsonï¼Œä¿®æ”¹é‡Œé¢çš„jsonä¸ºè‡ªå·±çš„å†…å®¹\n2. ä¹‹åå†è¾“å…¥`yarn build`è¿›è¡Œæ„å»º\n3. æ„å»ºå®Œæ¯•åï¼Œè¿è¡Œ`pm2 start ecosystem.config.js`å³å¯ï½\n4. æˆ‘ä»¬å»åˆ°å®å¡”çš„ç«™ç‚¹è®¾ç½®ï¼Œç‚¹å‡»åå‘ä»£ç†é€‰é¡¹å¡ï¼Œç‚¹å‡»æ·»åŠ åå‘ä»£ç†\n   `ä»£ç†åç§°`è‡ªå·±éšä¾¿å†™ï¼Œ`ç›®æ ‡URL`å¡«å†™ **[http://127.0.0.1:2323](http://127.0.0.1:2323/)** ï¼Œå…¶ä»–ä¸éœ€è¦æ”¹ï¼Œä¿å­˜å³å¯\n   ![https://gitee.com/wibus/blog-assets-goo/raw/master/asset-pic/iMac_2020-11-29ä¸Šåˆ7.35.41.jpg](https://gitee.com/wibus/blog-assets-goo/raw/master/asset-pic/iMac_2020-11-29%E4%B8%8A%E5%8D%887.35.41.jpg)\n\n## é™„åŠ å†…å®¹\n\nå¦‚æœå‘ç°adminä¿®æ”¹äº†é…ç½®åæ²¡æœ‰ç”Ÿæ•ˆ\n\nè¾“å…¥`redis-cli`ï¼Œè¿›å…¥rediså®¢æˆ·ç«¯\n\nè¾“å…¥FLUSHALLï¼Œå‡ºç°OKå³å¯ï½\n\n\næˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€ä¸‹htopè§‚å¯Ÿæ•´ä¸ªçš„å ç”¨çŠ¶æ€\n\n```bash\nyum install htop -y\nhtop\n```\n\nä»¥åŠè¿è¡Œå®Œåï¼Œæˆ‘ä»¬è¿è¡Œpm2 pså‘½ä»¤è§‚å¯Ÿä¸€ä¸‹æ˜¯å¦æˆåŠŸå¯åŠ¨\n\n```txt\nâ”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚\nâ”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ 1  â”‚ mx-space-graphql   â”‚ cluster  â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 54.6mb   â”‚\nâ”‚ 3  â”‚ mx-space-graphql   â”‚ cluster  â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 55.9mb   â”‚\nâ”‚ 0  â”‚ mx-space-server    â”‚ cluster  â”‚ 1    â”‚ online    â”‚ 0%       â”‚ 112.0mb  â”‚\nâ”‚ 2  â”‚ mx-space-server    â”‚ cluster  â”‚ 4    â”‚ online    â”‚ 0%       â”‚ 109.9mb  â”‚\nâ”‚ 4  â”‚ mx-web             â”‚ fork     â”‚ 5631 â”‚ online    â”‚ 0%       â”‚ 40.7mb   â”‚\nâ”‚ 5  â”‚ mx-web             â”‚ fork     â”‚ 8828 â”‚ online    â”‚ 0%       â”‚ 1.4mb    â”‚\nâ””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n## ä½¿ç”¨æ–‡æ¡£\n\nä½¿ç”¨æ–‡æ¡£ï¼šhttps://iucky.cn/mix-space-use","order":2},"__N_SSG":true}