{"ast":null,"code":"import _message from \"antd/lib/message\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport 'assets/styles/main.scss';\nimport { useStore } from 'common/store';\nimport Loader from 'components/Loader';\nimport configs from 'configs';\nimport { BasicLayout } from 'layouts/BasicLayout';\nimport throttle from 'lodash/throttle';\nimport { LogoJsonLd, NextSeo, SocialProfileJsonLd } from 'next-seo';\nimport { Router } from 'next/router';\nimport 'normalize.css';\nimport React, { useCallback, useState } from 'react';\nimport useMount from 'react-use/lib/useMount';\nimport useUnmount from 'react-use/lib/useUnmount';\nimport { UAParser } from 'ua-parser-js';\nimport Package from '../package.json';\nlet _currentY = 0;\n\nconst Content = props => {\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  const {\n    appStore: app\n  } = useStore();\n  useMount(() => {\n    printToConsole();\n    setLoading(false);\n    app.setLoading(false);\n    checkBrowser();\n    registerRouterEvents();\n    registerEvent();\n    initColorMode();\n    setPages();\n  });\n  const setPages = useCallback(() => {\n    fetch('/data/pages.json').then(res => {\n      res.json().then(json => {\n        const pages = Object.values(json);\n        app.setPage(pages.map(i => ({\n          created: i.created,\n          modified: i.modified,\n          order: i.order,\n          slug: i.slug,\n          title: i.title\n        })));\n      });\n    });\n  }, []);\n  const registerEvent = useCallback(() => {\n    const resizeHandler = throttle(() => {\n      app.updateViewport();\n    }, 300);\n    window.onresize = resizeHandler;\n    app.updateViewport();\n\n    if (typeof document !== 'undefined') {\n      document.addEventListener('scroll', handleScroll);\n    }\n  }, []);\n  const handleScroll = useCallback(throttle(() => {\n    const currentY = document.documentElement.scrollTop;\n    const direction = _currentY >= currentY ? 'up' : 'down';\n    app.updatePosition(direction);\n    _currentY = currentY;\n  }, 13), []);\n  const checkBrowser = useCallback(() => {\n    const parser = new UAParser(window.navigator.userAgent);\n    const browser = parser.getBrowser();\n\n    const isOld = (() => {\n      if (browser.name === 'IE') {\n        alert('欧尼酱, 乃真的要使用 IE 浏览器吗, 不如换个 Chrome 好不好嘛（o´ﾟ□ﾟ`o）');\n        location.href = 'https://www.google.com/chrome/';\n        return true;\n      } // check build-in methods\n\n\n      const ObjectMethods = ['fromEntries', 'entries'];\n      const ArrayMethods = ['flat'];\n\n      if (!window.Reflect || !(ObjectMethods.every(m => Reflect.has(Object, m)) && ArrayMethods.every(m => Reflect.has(Array.prototype, m))) || !window.requestAnimationFrame || !window.Proxy) {\n        return true;\n      }\n\n      return false;\n    })();\n\n    if (isOld) {\n      _message.warn('欧尼酱, 乃的浏览器太老了, 更新一下啦（o´ﾟ□ﾟ`o）');\n\n      class BrowserTooOldError extends Error {\n        constructor() {\n          const {\n            name: osName,\n            version: osVersion\n          } = parser.getOS();\n          super(`User browser(${browser.name} ${browser.version}) is too old. OS: ${osName}/${osVersion}`);\n        }\n\n      }\n\n      throw new BrowserTooOldError();\n    }\n  }, []);\n  useUnmount(() => {\n    window.onresize = null;\n    document.removeEventListener('scroll', handleScroll);\n  });\n  const initColorMode = useCallback(() => {\n    const getColormode = e => {\n      app.colorMode = e.matches ? 'dark' : 'light';\n      return app.colorMode;\n    };\n\n    app.colorMode = getColormode(window.matchMedia('(prefers-color-scheme: dark)'));\n\n    try {\n      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {\n        if (app.autoToggleColorMode) {\n          getColormode(e);\n        }\n      }); // eslint-disable-next-line no-empty\n    } catch {}\n  }, []);\n  const registerRouterEvents = useCallback(() => {\n    Router.events.on('routeChangeStart', url => {\n      setTimeout(() => {\n        if (app.loading) {\n          setLoading(true);\n        }\n      }, 500);\n      app.setLoading(true);\n    });\n    Router.events.on('routeChangeComplete', () => {\n      // window.scrollTo({ left: 0, top: 0, behavior: 'smooth' })\n      setLoading(false);\n      app.setLoading(false);\n    });\n    Router.events.on('routeChangeError', () => {\n      // window.scrollTo({ left: 0, top: 0, behavior: 'smooth' })\n      setLoading(false);\n      app.setLoading(false);\n\n      _message.error('出现了未知错误, 刷新试试?');\n    });\n  }, []);\n  return __jsx(React.Fragment, null, __jsx(NextSeo, {\n    title: configs.title + ' · ' + configs.description,\n    description: configs.description\n  }), __jsx(LogoJsonLd, {\n    logo: new URL('/custom-icon.svg', configs.url).toString(),\n    url: configs.url\n  }), __jsx(SocialProfileJsonLd, {\n    type: 'Person',\n    name: configs.author || '',\n    url: configs.url,\n    sameAs: configs.social.map(({\n      url\n    }) => url)\n  }), __jsx(\"div\", {\n    id: \"next\",\n    style: {\n      display: loading ? 'none' : ''\n    }\n  }, props.children), __jsx(Loader, null));\n};\n\nexport default function MyApp(ctx) {\n  const {\n    Component,\n    pageProps,\n    err\n  } = ctx;\n  return __jsx(Content, null, __jsx(BasicLayout, null, __jsx(Component, _extends({}, pageProps, {\n    err: err\n  }))));\n}\n\nfunction printToConsole() {\n  try {\n    const text = `\n    This Blog Powered By Mix Space.\n    --------\n    Stay hungry. Stay foolish. --Steve Jobs\n    `;\n    document.documentElement.prepend(document.createComment(text)); // eslint-disable-next-line no-empty\n  } catch {} finally {\n    console.log('%c Kico Style %c https://paugram.com ', 'color: #fff; margin: 1em 0; padding: 5px 0; background: #3498db;', 'margin: 1em 0; padding: 5px 0; background: #efefef;');\n    console.log(`%c Candy ${Package.version} %c https://innei.ren `, 'color: #fff; margin: 1em 0; padding: 5px 0; background: #2980b9;', 'margin: 1em 0; padding: 5px 0; background: #efefef;');\n  }\n}","map":null,"metadata":{},"sourceType":"module"}